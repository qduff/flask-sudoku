{% extends "base.html" %} {% block title %}Login{% endblock %} {% block content %}

<h1 class = "loadingtext">Loading board...</h1>
<div class='tablediv' >
    <table id="grid">
        <tr>
            <td>1</td>
            <td>2</td>
            <td>3</td>
            <td>4</td>
            <td>5</td>
            <td>6</td>
            <td>7</td>
            <td>8</td>
            <td>9</td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
        </tr>
    </table>
</div>

<script>
    var selX = null;
    var selY = null;

    function cellClick(e) {
        console.log("Click", e.target.cellIndex, e.target.parentElement.rowIndex)

        selX = e.target.cellIndex;
        selY = e.target.parentElement.rowIndex;

        selectCell();
    }

    function selectCell() {
        $("#grid tr td").removeClass("cell-selected");
        if (selX !== null && selY !== null) {
            $("#grid tr td").eq(selY * 9 + selX).addClass("cell-selected");
        }
    }

    function writeCell(digit) {
        if (selX !== null && selY !== null) {
            if (!$("#grid tr td").eq(selY * 9 + selX).hasClass("immutable-cell")) {
                $("#grid tr td").eq(selY * 9 + selX).text(digit.slice(0));
            }
        }
    }

    function clearCell() {
        if (selX !== null && selY !== null) {
            if (!$("#grid tr td").eq(selY * 9 + selX).hasClass("immutable-cell")) {
                $("#grid tr td").eq(selY * 9 + selX).text("");
            }
        }
    }

    function keyDown(e) {
        if (selX !== null && selY !== null) {
            if (!e.altKey) {
                // Normal movement
                if ((e.code == "KeyA" || e.code == "ArrowLeft") && selX > 0) {
                    selX -= 1;
                } else if ((e.code == "KeyD" || e.code == "ArrowRight") && selX < 8) {
                    selX += 1;
                } else if ((e.code == "KeyW" || e.code == "ArrowUp") && selY > 0) {
                    selY -= 1;
                } else if ((e.code == "KeyS" || e.code == "ArrowDown") && selY < 8) {
                    selY += 1;
                }
            } else {
                // Block movement
                if ((e.code == "KeyA" || e.code == "ArrowLeft")) {
                    if (selX >= 3) {
                        selX -= 3;
                    }
                    e.preventDefault();
                } else if ((e.code == "KeyD" || e.code == "ArrowRight")) {
                    if (selX <= 5) {
                        selX += 3;
                    }
                    e.preventDefault();
                } else if ((e.code == "KeyW" || e.code == "ArrowUp")) {
                    if (selY >= 3) {
                        selY -= 3;
                    }
                    e.preventDefault();
                } else if ((e.code == "KeyS" || e.code == "ArrowDown")) {
                    if (selY <= 5) {
                        selY += 3;
                    }
                    e.preventDefault();
                }
            }

            if (e.code.startsWith("Digit") && e.code != "Digit0") {
                writeCell(e.code.slice(-1))
            } else if (e.code == "Digit0" || e.code == "Backspace" || e.code == "Delete" || e.code == "Space") {
                clearCell();
            }

        }

        if (e.code == "Escape") {
            selX = null;
            selY = null;
        }

        selectCell();
        console.log(e.code);
        // console.log(e);
    }

    function fillSudoku(s) {
        for (var i in s.length) {
            console.log(s[i])
            if (s[i] == "0") continue;
            if (i < s.length) {
                $("#grid tr td").eq(i).text(s[i]);
                $("#grid tr td").eq(i).addClass("immutable-cell")
            }
        }
    }

    $("#grid tr td").on("click", cellClick);

    document.addEventListener("keydown", keyDown);
    
    var sudokuString = "004000067300470005150820003006000031802105604410000900700080046600012000930000710"

    fillSudoku(sudokuString);


    //var socket = io();

    //socket.on("connect", function() {
    //    socket.emit("requestsudoku", {
    //        "room": "{{gamecode}}"
    ////    });
    //})
    //socket.on("sudokustr", function(jason) {
    //    console.log(jason['content']);
    //    //$('#tablediv').show();
    //    //$('#loadingtext').hide();
    //    fillSudoku(jason['content']);
    //    console.log('filled')
    //});

</script>

{% endblock %}